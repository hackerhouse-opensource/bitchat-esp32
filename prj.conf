# Covekey Project Configuration - BitChat Bot

# Console and Logging
CONFIG_LOG=y
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_SERIAL=y
CONFIG_PRINTK=y
CONFIG_EARLY_CONSOLE=y

# GPIO (required by gpio_dt_spec + button code)
CONFIG_GPIO=y

# Buses
CONFIG_SPI=y
CONFIG_I2C=y

# LED strip core (driver is selected via devicetree compat)
CONFIG_LED_STRIP=y

# I2C Device Support
CONFIG_I2C_INIT_PRIORITY=60

# Bluetooth LE Support
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_CENTRAL=y
CONFIG_BT_OBSERVER=y
CONFIG_BT_BROADCASTER=y
CONFIG_BT_DEVICE_NAME="BitChat"
CONFIG_BT_DEVICE_NAME_DYNAMIC=n
CONFIG_BT_MAX_CONN=4
CONFIG_BT_L2CAP_TX_BUF_COUNT=3
CONFIG_BT_CONN_CHECK_NULL_BEFORE_CREATE=y

# ESP32-C6 CRITICAL: Enable parallel scan and connection initiation
# bt_le_scan_stop() crashes on ESP32-C6, this allows connections while scanning
CONFIG_BT_SCAN_AND_INITIATE_IN_PARALLEL=y

# GATT Client support (for mesh messaging)
CONFIG_BT_GATT_CLIENT=y

# MTU and buffer configuration
# Increased ACL buffer size to support higher ATT MTU negotiation
# ATT MTU is negotiated based on ACL buffer size, not L2CAP MTU
# 512 bytes allows ATT MTU of ~508 bytes, preventing fragmentation of TLV handshakes
CONFIG_BT_L2CAP_TX_MTU=512
CONFIG_BT_BUF_ACL_TX_SIZE=512
CONFIG_BT_BUF_ACL_RX_SIZE=512
CONFIG_BT_ATT_PREPARE_COUNT=1

# HCI buffer pool - increased for parallel scan+connect operations
CONFIG_BT_BUF_ACL_TX_COUNT=4

# BLE advertising - extended advertising required for parallel scan/initiate
# CONFIG_BT_EXT_ADV is auto-enabled by CONFIG_BT_SCAN_AND_INITIATE_IN_PARALLEL
CONFIG_BT_PRIVACY=n

# NO NETWORKING - Bluetooth only
CONFIG_NETWORKING=n

# PSA Crypto API (modern mbedTLS) for Noise XX protocol
CONFIG_MBEDTLS=y
CONFIG_MBEDTLS_BUILTIN=y
CONFIG_PSA_CRYPTO_PROVIDER_MBEDTLS=y
CONFIG_PSA_WANT_ALG_ECDH=y
CONFIG_PSA_WANT_ALG_SHA_256=y
CONFIG_PSA_WANT_ALG_HMAC=y
# Noise_XX requires ChaCha20-Poly1305, not AES-GCM
CONFIG_PSA_WANT_ALG_CHACHA20_POLY1305=y
CONFIG_PSA_WANT_KEY_TYPE_CHACHA20=y
# Noise_XX requires Curve25519 (X25519), not secp256r1
CONFIG_PSA_WANT_ECC_MONTGOMERY_255=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR_IMPORT=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR_EXPORT=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR_GENERATE=y
CONFIG_MBEDTLS_ENABLE_HEAP=y
CONFIG_MBEDTLS_HEAP_SIZE=40960

# Shell for interactive control
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_SERIAL=y
CONFIG_SHELL_PROMPT_UART="bitchat> "
CONFIG_SHELL_CMD_BUFF_SIZE=256
CONFIG_SHELL_ARGC_MAX=12

# Memory and Threading
CONFIG_MAIN_STACK_SIZE=8192
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=8192
CONFIG_HEAP_MEM_POOL_SIZE=65536

# ESP32-C6 BLE soft controller stability - increased buffers
CONFIG_BT_BUF_EVT_RX_COUNT=16
CONFIG_BT_BUF_CMD_TX_COUNT=8
CONFIG_BT_RX_STACK_SIZE=2048

# CRITICAL: Extended advertising/scanning buffer size limits for ESP32-C6
# When CONFIG_BT_SCAN_AND_INITIATE_IN_PARALLEL=y, BT_EXT_ADV is auto-enabled
# Extended advertising scan reports require 122 bytes for HCI event buffers
# ESP32-C6 ACL data buffers limited to 58 bytes, but event buffers can be larger
CONFIG_BT_BUF_EVT_DISCARDABLE_SIZE=122
CONFIG_BT_BUF_EVT_DISCARDABLE_COUNT=8
CONFIG_BT_BUF_EVT_RX_SIZE=122

# System
CONFIG_REBOOT=y
